{% extends 'racing/base.html' %}

{% block title %}–°–µ–∑–æ–Ω {{ year }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-uppercase">–ò—Ç–æ–≥–∏ —Å–µ–∑–æ–Ω–∞ <span class="text-danger">{{ year }}</span></h2>

    <!-- –í—ã–±–æ—Ä –≥–æ–¥–∞ -->
    <form method="get" action="" id="yearForm">
        <select class="form-select fw-bold bg-light border-0 shadow-sm" style="cursor: pointer;"
                onchange="window.location.href='../' + this.value + '/'">
            {% for y in available_years %}
                <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>
    </form>
</div>

<!-- –í–ö–õ–ê–î–ö–ò (TABS) -->
<ul class="nav nav-pills mb-4 justify-content-center" id="seasonTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active fw-bold px-4" id="drivers-tab" data-bs-toggle="tab" data-bs-target="#drivers" type="button" role="tab">
            <i class="bi bi-person-fill"></i> –õ–∏—á–Ω—ã–π –∑–∞—á–µ—Ç
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link fw-bold px-4" id="constructors-tab" data-bs-toggle="tab" data-bs-target="#constructors" type="button" role="tab">
            <i class="bi bi-trophy-fill"></i> –ö—É–±–æ–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤
        </button>
    </li>
</ul>

<div class="tab-content" id="seasonTabContent">

    <!-- 1. –¢–ê–ë–õ–ò–¶–ê –ü–ò–õ–û–¢–û–í -->
    <div class="tab-pane fade show active" id="drivers" role="tabpanel">
        <div class="card border-0 shadow-sm">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light text-uppercase small text-muted">
                        <tr>
                            <th class="text-center" style="width: 60px;">–ü–æ–∑</th>
                            <th>–ü–∏–ª–æ—Ç</th>
                            <th>–ö–æ–º–∞–Ω–¥–∞</th>
                            <th class="text-center">–ü–æ–±–µ–¥—ã</th>
                            <th class="text-center">–ü–æ–¥–∏—É–º—ã</th>
                            <th class="text-center fw-bold text-dark" style="font-size: 1.1em;">–û—á–∫–∏</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in driver_standings %}
                        <!--
                           –°–¢–ò–õ–ò:
                           1. class="table-warning" - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ª–∏–¥–µ—Ä–∞
                           2. border-left - —Ü–≤–µ—Ç–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞ –∫–æ–º–∞–Ω–¥—ã
                        -->
                        <tr {% if forloop.counter == 1 %}class="table-warning"{% endif %}
                            style="border-left: 5px solid {{ row.team.hex_color|default:'#ccc' }};">

                            <!-- –ü–æ–∑–∏—Ü–∏—è —Å –º–µ–¥–∞–ª—å–∫–∞–º–∏ -->
                            <td class="text-center fw-bold fs-5">
                                {% if forloop.counter == 1 %}ü•á
                                {% elif forloop.counter == 2 %}ü•à
                                {% elif forloop.counter == 3 %}ü•â
                                {% else %}<span class="text-muted small">{{ forloop.counter }}</span>
                                {% endif %}
                            </td>

                            <!-- –ü–∏–ª–æ—Ç -->
                            <td>
                                <div class="d-flex align-items-center">
                                    {% if row.driver.photo_cutout %}
                                    <img src="{{ row.driver.photo_cutout.url }}" class="rounded-circle border me-3 bg-light" style="width: 45px; height: 45px; object-fit: cover; object-position: top;">
                                    {% elif row.driver.photo %}
                                    <img src="{{ row.driver.photo.url }}" class="rounded-circle border me-3 bg-white" style="width: 45px; height: 45px; object-fit: cover;">
                                    {% else %}
                                        <div class="rounded-circle bg-white border me-3 d-flex align-items-center justify-content-center text-muted" style="width: 45px; height: 45px;">
                                            <i class="bi bi-person-fill"></i>
                                        </div>
                                    {% endif %}
                                    <div>
                                        <a href="{% url 'driver_detail' row.driver.driver_ref %}" class="text-decoration-none text-dark fw-bold fs-5">
                                            {{ row.driver.forename }} {{ row.driver.surname }}
                                        </a>
                                    </div>
                                </div>
                            </td>

                            <!-- –ö–æ–º–∞–Ω–¥–∞ (–ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç, —Ç–∞–∫ –∫–∞–∫ —Ü–≤–µ—Ç —É–∂–µ –µ—Å—Ç—å —Å–ª–µ–≤–∞) -->
                            <td>
                                {% if row.team %}
                                    <a href="{% url 'constructor_detail' row.team.constructor_ref %}" class="text-decoration-none fw-bold" style="color: {{ row.team.hex_color|default:'#333' }}">
                                        {{ row.team.name }}
                                    </a>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>

                            <td class="text-center">{{ row.wins }}</td>
                            <td class="text-center">{{ row.podiums }}</td>

                            <!-- –û—á–∫–∏ (–ö—Ä—É–ø–Ω–æ, –∫–∞–∫ —É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤) -->
                            <td class="text-center">
                                <span class="fw-bold fs-5">{{ row.points|floatformat:0 }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 2. –¢–ê–ë–õ–ò–¶–ê –ö–û–ú–ê–ù–î -->
    <div class="tab-pane fade" id="constructors" role="tabpanel">
        <div class="card border-0 shadow-sm">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light text-uppercase small text-muted">
                        <tr>
                            <th class="text-center" style="width: 60px;">–ü–æ–∑</th>
                            <th style="width: 40%;">–ö–æ–º–∞–Ω–¥–∞</th>
                            <th class="text-center">–ü–æ–±–µ–¥—ã</th>
                            <th class="text-center">–ü–æ–¥–∏—É–º—ã</th>
                            <th class="text-center fw-bold text-dark" style="font-size: 1.1em;">–û—á–∫–∏</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in team_standings %}
                        <!--
                           –°–¢–ò–õ–ò:
                           1. class="table-warning" - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ª–∏–¥–µ—Ä–∞
                           2. border-left - —Ü–≤–µ—Ç–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞ –∫–æ–º–∞–Ω–¥—ã
                        -->
                        <tr {% if forloop.counter == 1 %}class="table-warning"{% endif %}
                            style="border-left: 5px solid {{ row.team.hex_color|default:'#ccc' }};">

                            <!-- –ü–æ–∑–∏—Ü–∏—è —Å –º–µ–¥–∞–ª—å–∫–∞–º–∏ (–î–æ–±–∞–≤–∏–ª–∏ –∏ —Å—é–¥–∞!) -->
                            <td class="text-center fw-bold fs-5">
                                {% if forloop.counter == 1 %}ü•á
                                {% elif forloop.counter == 2 %}ü•à
                                {% elif forloop.counter == 3 %}ü•â
                                {% else %}<span class="text-muted small">{{ forloop.counter }}</span>
                                {% endif %}
                            </td>

                            <!-- –ö–æ–º–∞–Ω–¥–∞ -->
                            <td>
                                <div class="d-flex align-items-center">
                                    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ª–æ–≥–æ -->
                                    <div class="me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 40px;">
                                        {% if row.team.logo %}
                                            <img src="{{ row.team.logo.url }}"
                                                 alt="{{ row.team.name }}"
                                                 style="max-height: 100%; max-width: 100%; object-fit: contain;">
                                        {% endif %}
                                    </div>

                                    <a href="{% url 'constructor_detail' row.team.constructor_ref %}" class="text-decoration-none text-dark fw-bold fs-5">
                                        {{ row.team.name }}
                                    </a>
                                </div>
                            </td>

                            <td class="text-center">{{ row.wins }}</td>
                            <td class="text-center">{{ row.podiums }}</td>

                            <!-- –û—á–∫–∏ (–ö—Ä—É–ø–Ω–æ) -->
                            <td class="text-center">
                                <span class="fw-bold fs-5">{{ row.points|floatformat:0 }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- –°–ö–†–ò–ü–¢ –î–õ–Ø –ó–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø –ê–ö–¢–ò–í–ù–û–ô –í–ö–õ–ê–î–ö–ò -->
<script>
    document.addEventListener("DOMContentLoaded", function(){
        var activeTab = localStorage.getItem('activeSeasonTab');
        if (activeTab) {
            var tabTrigger = document.querySelector('button[data-bs-target="' + activeTab + '"]');
            if (tabTrigger) {
                var tab = new bootstrap.Tab(tabTrigger);
                tab.show();
            }
        }
        var tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');
        tabElements.forEach(function(tabEl) {
            tabEl.addEventListener('shown.bs.tab', function (event) {
                var targetId = event.target.getAttribute('data-bs-target');
                localStorage.setItem('activeSeasonTab', targetId);
            });
        });
    });
</script>

{% endblock %}